{layout='site/-layout'}

{exp:channel:entries
    channel="products"
    limit="1"
    dynamic="yes"
    require_entry="yes"
    disable="categories|member_data|pagination"
}

{if no_results}{redirect="404"}{/if}

{!-- Set entry id for better meta --}
{layout:set name="entry_id" value="{entry_id}"}
{layout:set name="title_suffix" value="Products"}

{!-- Additional Open Graph meta
{layout:set name="og_image" value="{cf_product_feature_image:revved_url:facebook-2x}"}
{layout:set name="og_image:height" value="{cf_product_feature_image:height:facebook-2x}"}
{layout:set name="og_image:width" value="{cf_product_feature_image:width:facebook-2x}"}
--}

{embed='site/-breadcrumb'
    topic_url='{topic_category_url_title}'
    topic_name='{topic_category_name}'
    content_type_url='products'
    content_type_name='Products'
}

{embed='advertisement/-ad-placeholder' ad_search_query='{cf_product_ad_search_query}' topic_category_id='{topic_category_id}'}

<h1>{title} ({cf_product_related_brand:title})</h1>

{cf_product_content}

{embed='store/_form-add-to-cart' entry_id='{entry_id}'}

{if cf_product_feature_image}
    <img
        src="{cf_product_feature_image:revved_url:feature-1x}"
        width="{cf_product_feature_image:width:feature-1x}"
        height="{cf_product_feature_image:height:feature-1x}"
        srcset="{cf_product_feature_image:revved_url:feature-2x} 2x"
        />
    {if cf_product_feature_video}
    <iframe id="player"
            type="text/html"
            width="1024"
            height="576"
            src="http://www.youtube.com/embed/{cf_product_feature_video}?enablejsapi=1&origin=http://example.com"
            frameborder="0">
    </iframe>
    {/if}
{/if}

{embed='comments/_form-create' href='{url_title_path='products/details'}'}

<h2>Related Products</h2>
{embed='articles/-entries' entry_id='{exp:nsm_utils:relationship_child_ids entry_id="{entry_id}" field="cf_product_related_products"}|-1'}

<h2>Related Articles</h2>
{embed='articles/-entries' entry_id='{exp:nsm_utils:relationship_child_ids entry_id="{entry_id}" field="cf_product_related_articles"}|-1'}


{/exp:channel:entries}
