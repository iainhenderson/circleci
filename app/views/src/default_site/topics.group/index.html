{layout="site/-layout"}

{exp:channel:entries
    channel="topics"
    limit="1"
    dynamic="no"
    url_title="{segment_1}"
}

{if no_results}{redirect="404"}{/if}

{!-- Set entry id for better meta --}
{layout:set name="entry_id" value="{entry_id}"}

{!-- Additional Open Graph meta --}
{layout:set name="og_image" value="{cf_topic_feature_image:revved_url:facebook-2x}"}
{layout:set name="og_image:height" value="{cf_topic_feature_image:height:facebook-2x}"}
{layout:set name="og_image:width" value="{cf_topic_feature_image:width:facebook-2x}"}

{embed='advertisements/-ad-placeholder'}

<h1>{title}</h1>

{embed="topics/-search-shortcuts-nav"
        shortcut_group_id="{cf_topics_ls_shortcut_group_id}"
}

{cf_topic_content}

{if cf_topic_feature_image}
<img
    src="{cf_topic_feature_image:revved_url:background-1x}"
    width="{cf_topic_feature_image:width:background-1x}"
    height="{cf_topic_feature_image:height:background-1x}"
    srcset="{cf_topic_feature_image:revved_url:background-2x} 2x"
/>
{/if}

<h2>From the forums</h2>
{embed="_forums/-entries"
    topic_id="{cf_topic_feature_form_posts}"
    limit="10"
}

<h2>Most popular content</h2>
{embed="topics/-entries"
    entry_id="{exp:nsm_utils:relationship_child_ids entry_id='{entry_id}' field='cf_topic_most_popular'}|-1"
    limit="10"
    paginate="none"
}

<h2>Products in the store</h2>
{embed="products/-entries"
    entry_id="{exp:nsm_utils:relationship_child_ids entry_id='{entry_id}' field='cf_topic_related_products'}|-1"
    limit="10"
    paginate="none"
}

<h2>Shop by brand</h2>
{embed="brands/-entries"
    entry_id="{exp:nsm_utils:relationship_child_ids entry_id='{entry_id}' field='cf_topic_related_brands'}|-1"
    limit="10"
    paginate="none"
}

<h2>New Articles</h2>
{embed="articles/-entries"
    category="{cf_topic_content_categories}"
    limit="10"
    paginate="none"
}

{/exp:channel:entries}
